"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.addTempSwcrc = void 0;
const devkit_1 = require("@nrwl/devkit");
const fs_1 = require("fs");
const path_1 = require("path");
// TODO(chau): "exclude" is required here to exclude spec files as --ignore cli option is not working atm
// Open issue: https://github.com/swc-project/cli/issues/20
function addTempSwcrc(options) {
    const tmpPath = (0, path_1.join)(options.root, 'tmp', options.projectRoot, '.swcrc.generated');
    const swcrcJson = (0, devkit_1.readJsonFile)((0, path_1.join)(options.projectRoot, '.swcrc'));
    process.on('exit', cleanUpSwcrc(tmpPath));
    (0, devkit_1.writeJsonFile)(tmpPath, Object.assign(Object.assign({}, swcrcJson), { exclude: options.swcExclude }));
    return tmpPath;
}
exports.addTempSwcrc = addTempSwcrc;
function cleanUpSwcrc(tmpPath) {
    return () => {
        try {
            if (tmpPath) {
                (0, fs_1.unlinkSync)(tmpPath);
            }
        }
        catch (e) { }
    };
}
//# sourceMappingURL=add-temp-swcrc.js.map