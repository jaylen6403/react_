{"ast":null,"code":"import \"core-js/modules/es.array.iterator.js\";\nimport \"core-js/modules/web.dom-collections.iterator.js\";\nimport \"core-js/modules/web.url-search-params.js\";\nimport { createApi } from '@reduxjs/toolkit/query/react';\nimport { fetchBaseQueryWithRefresh } from '../../utils/fetchBaseQueryWithRefresh';\nimport { apiUrl, oauthClientId } from '@luma-fe-workspace/utility';\nimport { prepareHeadersWithAuth } from '../../utils/prepareHeadersWithAuth';\nexport const authApi = createApi({\n  reducerPath: 'authService',\n  baseQuery: fetchBaseQueryWithRefresh({\n    baseUrl: `${apiUrl}/auth-service/`,\n    prepareHeaders: prepareHeadersWithAuth(['login', 'validateToken'])\n  }),\n  endpoints: builder => ({\n    login: builder.mutation({\n      query: ({\n        username,\n        password\n      }) => ({\n        headers: {\n          'content-type': 'application/x-www-form-urlencoded'\n        },\n        url: `oauth/token?grant_type=password&client_id=${oauthClientId}&scope=webclient`,\n        method: 'POST',\n        body: new URLSearchParams({\n          username,\n          password\n        })\n      })\n    }),\n    validateToken: builder.query({\n      query: ({\n        bearer\n      }) => ({\n        headers: {\n          'content-type': 'application/json',\n          Authorization: `Bearer ${bearer}`\n        },\n        url: 'token-info/user',\n        method: 'GET'\n      })\n    }),\n    revokeToken: builder.mutation({\n      query: () => ({\n        url: 'tokens/current',\n        method: 'DELETE'\n      })\n    }),\n    removeRMT: builder.mutation({\n      query: () => ({\n        url: 'rmt/logout',\n        method: 'GET'\n      })\n    }),\n    crossSiteCst: builder.query({\n      query: () => ({\n        url: 'cross-site/cst',\n        method: 'GET',\n        responseHandler: response => response.text()\n      })\n    })\n  })\n});\nexport const {\n  useLoginMutation,\n  useValidateTokenQuery,\n  useRevokeTokenMutation,\n  useRemoveRMTMutation,\n  useCrossSiteCstQuery\n} = authApi;","map":{"version":3,"names":["createApi","fetchBaseQueryWithRefresh","apiUrl","oauthClientId","prepareHeadersWithAuth","authApi","reducerPath","baseQuery","baseUrl","prepareHeaders","endpoints","builder","login","mutation","query","username","password","headers","url","method","body","URLSearchParams","validateToken","bearer","Authorization","revokeToken","removeRMT","crossSiteCst","responseHandler","response","text","useLoginMutation","useValidateTokenQuery","useRevokeTokenMutation","useRemoveRMTMutation","useCrossSiteCstQuery"],"sources":["/Users/jchen/Documents/GitHub/luma-fe-workspace/libs/redux/src/redux/authService/slice.ts"],"sourcesContent":["import { createApi } from '@reduxjs/toolkit/query/react';\nimport { fetchBaseQueryWithRefresh } from '../../utils/fetchBaseQueryWithRefresh';\nimport { apiUrl, oauthClientId } from '@luma-fe-workspace/utility';\nimport { prepareHeadersWithAuth } from '../../utils/prepareHeadersWithAuth';\n\nexport interface AuthResponse {\n  access_token: string;\n  refresh_token: string;\n  name: string;\n  firstName?: string;\n  lastName?: string;\n  company?: string;\n  uuid: string;\n  permissions: string[];\n  splitIds: string[];\n  token_type: string;\n  scope: string[];\n  locale: string;\n  jti: string;\n  expires_in: number;\n}\n\ninterface Credentials {\n  username: string;\n  password: string;\n}\n\nexport interface AuthErrorResponse {\n  error: string;\n  error_description: string;\n}\n\nexport const authApi = createApi({\n  reducerPath: 'authService',\n  baseQuery: fetchBaseQueryWithRefresh({\n    baseUrl: `${apiUrl}/auth-service/`,\n    prepareHeaders: prepareHeadersWithAuth(['login', 'validateToken']),\n  }),\n  endpoints: (builder) => ({\n    login: builder.mutation<AuthResponse, Credentials>({\n      query: ({ username, password }) => ({\n        headers: { 'content-type': 'application/x-www-form-urlencoded' },\n        url: `oauth/token?grant_type=password&client_id=${oauthClientId}&scope=webclient`,\n        method: 'POST',\n        body: new URLSearchParams({ username, password }),\n      }),\n    }),\n    validateToken: builder.query<AuthResponse, { bearer: string }>({\n      query: ({ bearer }) => ({\n        headers: {\n          'content-type': 'application/json',\n          Authorization: `Bearer ${bearer}`,\n        },\n        url: 'token-info/user',\n        method: 'GET',\n      }),\n    }),\n    revokeToken: builder.mutation<void, void>({\n      query: () => ({\n        url: 'tokens/current',\n        method: 'DELETE',\n      }),\n    }),\n    removeRMT: builder.mutation<void, void>({\n      query: () => ({\n        url: 'rmt/logout',\n        method: 'GET',\n      }),\n    }),\n    crossSiteCst: builder.query<string, void>({\n      query: () => ({\n        url: 'cross-site/cst',\n        method: 'GET',\n        responseHandler: (response: Response) => response.text(),\n      }),\n    }),\n  }),\n});\n\nexport const {\n  useLoginMutation,\n  useValidateTokenQuery,\n  useRevokeTokenMutation,\n  useRemoveRMTMutation,\n  useCrossSiteCstQuery,\n} = authApi;\n"],"mappings":";;;AAAA,SAASA,SAAT,QAA0B,8BAA1B;AACA,SAASC,yBAAT,QAA0C,uCAA1C;AACA,SAASC,MAAT,EAAiBC,aAAjB,QAAsC,4BAAtC;AACA,SAASC,sBAAT,QAAuC,oCAAvC;AA6BA,OAAO,MAAMC,OAAO,GAAGL,SAAS,CAAC;EAC/BM,WAAW,EAAE,aADkB;EAE/BC,SAAS,EAAEN,yBAAyB,CAAC;IACnCO,OAAO,EAAG,GAAEN,MAAO,gBADgB;IAEnCO,cAAc,EAAEL,sBAAsB,CAAC,CAAC,OAAD,EAAU,eAAV,CAAD;EAFH,CAAD,CAFL;EAM/BM,SAAS,EAAGC,OAAD,KAAc;IACvBC,KAAK,EAAED,OAAO,CAACE,QAAR,CAA4C;MACjDC,KAAK,EAAE,CAAC;QAAEC,QAAF;QAAYC;MAAZ,CAAD,MAA6B;QAClCC,OAAO,EAAE;UAAE,gBAAgB;QAAlB,CADyB;QAElCC,GAAG,EAAG,6CAA4Cf,aAAc,kBAF9B;QAGlCgB,MAAM,EAAE,MAH0B;QAIlCC,IAAI,EAAE,IAAIC,eAAJ,CAAoB;UAAEN,QAAF;UAAYC;QAAZ,CAApB;MAJ4B,CAA7B;IAD0C,CAA5C,CADgB;IASvBM,aAAa,EAAEX,OAAO,CAACG,KAAR,CAAgD;MAC7DA,KAAK,EAAE,CAAC;QAAES;MAAF,CAAD,MAAiB;QACtBN,OAAO,EAAE;UACP,gBAAgB,kBADT;UAEPO,aAAa,EAAG,UAASD,MAAO;QAFzB,CADa;QAKtBL,GAAG,EAAE,iBALiB;QAMtBC,MAAM,EAAE;MANc,CAAjB;IADsD,CAAhD,CATQ;IAmBvBM,WAAW,EAAEd,OAAO,CAACE,QAAR,CAA6B;MACxCC,KAAK,EAAE,OAAO;QACZI,GAAG,EAAE,gBADO;QAEZC,MAAM,EAAE;MAFI,CAAP;IADiC,CAA7B,CAnBU;IAyBvBO,SAAS,EAAEf,OAAO,CAACE,QAAR,CAA6B;MACtCC,KAAK,EAAE,OAAO;QACZI,GAAG,EAAE,YADO;QAEZC,MAAM,EAAE;MAFI,CAAP;IAD+B,CAA7B,CAzBY;IA+BvBQ,YAAY,EAAEhB,OAAO,CAACG,KAAR,CAA4B;MACxCA,KAAK,EAAE,OAAO;QACZI,GAAG,EAAE,gBADO;QAEZC,MAAM,EAAE,KAFI;QAGZS,eAAe,EAAGC,QAAD,IAAwBA,QAAQ,CAACC,IAAT;MAH7B,CAAP;IADiC,CAA5B;EA/BS,CAAd;AANoB,CAAD,CAAzB;AA+CP,OAAO,MAAM;EACXC,gBADW;EAEXC,qBAFW;EAGXC,sBAHW;EAIXC,oBAJW;EAKXC;AALW,IAMT9B,OANG"},"metadata":{},"sourceType":"module"}