{"ast":null,"code":"import \"core-js/modules/es.array.reduce.js\";\nimport \"core-js/modules/es.object.assign.js\";\nimport { colors } from '@luma-fe-workspace/design-system';\nimport { getConversionRate } from '../components/PortfolioWidget/StructuredProducts/structuredProductsPortfolioUtils';\nexport const issuerTableColumnData = [{\n  field: 'Issuers',\n  cellStyle: params => {\n    if (params.rowIndex === 0) {\n      return {\n        borderLeft: `0.5rem ${colors.primary90} solid`\n      };\n    }\n\n    if (params.rowIndex === 1) {\n      return {\n        borderLeft: `0.5rem ${colors.primary80Daintree} solid`\n      };\n    }\n\n    if (params.rowIndex === 2) {\n      return {\n        borderLeft: `0.5rem ${colors.primary60} solid`\n      };\n    }\n\n    if (params.rowIndex === 3) {\n      return {\n        borderLeft: `0.5rem ${colors.primary40} solid`\n      };\n    }\n\n    if (params.rowIndex === 4) {\n      return {\n        borderLeft: `0.5rem ${colors.primary20} solid`\n      };\n    }\n\n    return;\n  }\n}, {\n  field: 'Orders',\n  cellStyle: {\n    justifyContent: 'flex-end'\n  },\n  headerClass: 'ag-right-aligned-header'\n}, {\n  field: 'Notional',\n  cellStyle: {\n    justifyContent: 'flex-end'\n  },\n  headerClass: 'ag-right-aligned-header'\n}];\nexport const getIssuer = (data, selectedCurrency, currencyConversionData) => {\n  const {\n    portfolioProducts\n  } = data[0];\n\n  if (!portfolioProducts) {\n    return null;\n  }\n\n  const currencyConversionMap = currencyConversionData.reduce((acc, cur) => {\n    if (cur.conversionRates) {\n      acc[cur.isoCode] = cur.conversionRates;\n    }\n\n    return acc;\n  }, {});\n  return portfolioProducts.reduce((acc, cur) => {\n    const {\n      currency\n    } = cur;\n    const conversionRate = getConversionRate(currency || '', selectedCurrency, currencyConversionMap);\n\n    if (cur.issuer) {\n      var _cur$orders, _cur$orders2;\n\n      const notionalSum = (_cur$orders = cur.orders) == null ? void 0 : _cur$orders.reduce((preVal, currVal) => {\n        if (currVal.quantity) {\n          return preVal + (currVal == null ? void 0 : currVal.quantity);\n        }\n\n        return preVal;\n      }, 0);\n      const issuerSum = notionalSum ? notionalSum * conversionRate : 0;\n      const count = ((_cur$orders2 = cur.orders) == null ? void 0 : _cur$orders2.length) || 0;\n\n      if (cur.issuer in acc) {\n        return Object.assign({}, acc, {\n          [cur.issuer]: {\n            count: acc[cur.issuer].count + count,\n            notionalSum: acc[cur.issuer].notionalSum + issuerSum\n          }\n        });\n      } else {\n        return Object.assign({}, acc, {\n          [cur.issuer]: {\n            count: count,\n            notionalSum: issuerSum\n          }\n        });\n      }\n    }\n\n    return acc;\n  }, Object.create({}));\n};","map":{"version":3,"names":["colors","getConversionRate","issuerTableColumnData","field","cellStyle","params","rowIndex","borderLeft","primary90","primary80Daintree","primary60","primary40","primary20","justifyContent","headerClass","getIssuer","data","selectedCurrency","currencyConversionData","portfolioProducts","currencyConversionMap","reduce","acc","cur","conversionRates","isoCode","currency","conversionRate","issuer","notionalSum","orders","preVal","currVal","quantity","issuerSum","count","length","Object","create"],"sources":["/Users/jchen/Documents/GitHub/luma-fe-workspace/libs/luma/dashboard/src/utils/issuerUtils.ts"],"sourcesContent":["import {\n  ConversionRate,\n  Currency,\n  PortfolioV2,\n} from '@luma-fe-workspace/redux';\nimport { ColDef } from 'ag-grid-community';\nimport { colors } from '@luma-fe-workspace/design-system';\nimport { getConversionRate } from '../components/PortfolioWidget/StructuredProducts/structuredProductsPortfolioUtils';\n\ntype IssuerSum = {\n  count: number;\n  notionalSum: number;\n};\n\ntype IssuerSums = {\n  [key: number | string]: IssuerSum;\n};\n\ntype CurrencyMap = {\n  [key: string]: { [key: string]: ConversionRate };\n};\n\nexport const issuerTableColumnData: ColDef[] = [\n  {\n    field: 'Issuers',\n    cellStyle: (params) => {\n      if (params.rowIndex === 0) {\n        return {\n          borderLeft: `0.5rem ${colors.primary90} solid`,\n        };\n      }\n      if (params.rowIndex === 1) {\n        return {\n          borderLeft: `0.5rem ${colors.primary80Daintree} solid`,\n        };\n      }\n      if (params.rowIndex === 2) {\n        return {\n          borderLeft: `0.5rem ${colors.primary60} solid`,\n        };\n      }\n      if (params.rowIndex === 3) {\n        return {\n          borderLeft: `0.5rem ${colors.primary40} solid`,\n        };\n      }\n      if (params.rowIndex === 4) {\n        return {\n          borderLeft: `0.5rem ${colors.primary20} solid`,\n        };\n      }\n      return;\n    },\n  },\n  {\n    field: 'Orders',\n    cellStyle: { justifyContent: 'flex-end' },\n    headerClass: 'ag-right-aligned-header',\n  },\n  {\n    field: 'Notional',\n    cellStyle: { justifyContent: 'flex-end' },\n    headerClass: 'ag-right-aligned-header',\n  },\n];\n\nexport const getIssuer = (\n  data: PortfolioV2[],\n  selectedCurrency: string,\n  currencyConversionData: Currency[]\n): IssuerSums | null => {\n  const { portfolioProducts } = data[0];\n  if (!portfolioProducts) {\n    return null;\n  }\n  const currencyConversionMap: CurrencyMap = currencyConversionData.reduce(\n    (acc, cur) => {\n      if (cur.conversionRates) {\n        acc[cur.isoCode] = cur.conversionRates;\n      }\n\n      return acc;\n    },\n    {} as CurrencyMap\n  );\n  return portfolioProducts.reduce((acc, cur) => {\n    const { currency } = cur;\n    const conversionRate = getConversionRate(\n      currency || '',\n      selectedCurrency,\n      currencyConversionMap\n    );\n    if (cur.issuer) {\n      const notionalSum = cur.orders?.reduce((preVal, currVal) => {\n        if (currVal.quantity) {\n          return preVal + currVal?.quantity;\n        }\n        return preVal;\n      }, 0);\n      const issuerSum = notionalSum ? notionalSum * conversionRate : 0;\n      const count = cur.orders?.length || 0;\n      if (cur.issuer in acc) {\n        return {\n          ...acc,\n          [cur.issuer]: {\n            count: acc[cur.issuer].count + count,\n            notionalSum: acc[cur.issuer].notionalSum + issuerSum,\n          },\n        };\n      } else {\n        return {\n          ...acc,\n          [cur.issuer]: {\n            count: count,\n            notionalSum: issuerSum,\n          },\n        };\n      }\n    }\n    return acc;\n  }, Object.create({} as IssuerSums));\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}